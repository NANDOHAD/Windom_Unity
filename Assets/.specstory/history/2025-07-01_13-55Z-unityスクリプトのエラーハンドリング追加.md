<!-- Generated by SpecStory -->

# Unityスクリプトのエラーハンドリング追加 (2025-07-01 13:55Z)

_**User**_

このUnityスクリプト内の各ImportModelについて、エラーハンドリングを行いたいので各処理にデバッグログを追加してください。コンソール上に出力されるログは日本語で書かれているとありがたいです。

---

_**Assistant**_

```diff
      void ImportModel(GameObject GO, string file, bool isAlpha = false)
      {
+         Debug.Log($"[ImportModel(GameObject)] モデルのインポートを開始します: {file}");
          if (File.Exists(file))
          {
- 			
              try
              {
                  string Modelpath = Path.GetDirectoryName(file);
- 
+                 Debug.Log($"[ImportModel(GameObject)] モデルパス: {Modelpath}");
                  var scen = Importer.ImportFile(file, Helper.PostProcessStepflags);
+                 Debug.Log($"[ImportModel(GameObject)] シーンのインポートに成功しました: {file}");
                  Mesh mesh = new Mesh();
                  mesh.CombineMeshes(scen.Meshes.Select(x => new CombineInstance()
```

```diff
                      transform = scen.RootNode.Transform.ToUnityMatrix()
                  }).ToArray(), false);
+                 Debug.Log($"[ImportModel(GameObject)] メッシュの結合に成功しました: {file}");
                  Material[] materials = new Material[scen.Meshes.Length];
  
```

```diff
                          mat.color = new Color(color.R, color.G, color.B, color.A);
                          //mat.SetFloat("_Glossiness", scen.Materials[scen.Meshes[index].MaterialIndex].ShininessStrength);
- 
  
                          if (textures.Length > 0 && File.Exists(Path.Combine(Modelpath, textures[0].FilePath)))
```

```diff
                                  FileInfo f = new FileInfo(Path.Combine(Modelpath, textures[0].FilePath));
                                  if (f.Extension == ".dds")
+                                 {
                                      mat.mainTexture = DdsTextureLoader.LoadTexture(f.FullName);
+                                     Debug.Log($"[ImportModel(GameObject)] DDSテクスチャを読み込みました: {f.FullName}");
+                                 }
                                  else
+                                 {
                                      mat.mainTexture = Helper.LoadTexture(f.FullName);
+                                     Debug.Log($"[ImportModel(GameObject)] テクスチャを読み込みました: {f.FullName}");
+                                 }
                              }
- 							catch
- 							{
+                             catch (Exception texEx)
+                             {
+                                 Debug.LogWarning($"[ImportModel(GameObject)] テクスチャの読み込みに失敗しました: {textures[0].FilePath} エラー: {texEx.Message}");
+                             }
+                         }
+                         else
+                         {
+                             Debug.Log($"[ImportModel(GameObject)] テクスチャが見つかりません: {textures.FirstOrDefault()?.FilePath}");
                          }
                      }
+                     else
+                     {
+                         Debug.Log($"[ImportModel(GameObject)] マテリアル情報が見つかりません: index={index}");
                      }
  
```

```diff
                  //part.AddComponent<MeshCollider>().sharedMesh = mesh; 
                  GO.AddComponent<MeshRenderer>().materials = materials;
+                 Debug.Log($"[ImportModel(GameObject)] モデルのインポートが完了しました: {file}");
              }
- 			catch
+             catch (Exception ex)
              {
+                 Debug.LogError($"[ImportModel(GameObject)] モデルのインポート中にエラーが発生しました: {file} エラー: {ex.Message}");
              }
          }
+         else
+         {
+             Debug.LogError($"[ImportModel(GameObject)] ファイルが存在しません: {file}");
+         }
      }
  
      void ImportModel(string file, ref Mesh mesh, ref Material[] materials, bool isAlpha = false)
      {
- 		
+         Debug.Log($"[ImportModel(ref)] モデルのインポートを開始します: {file}");
          if (File.Exists(file))
          {
- 		
              try
              {
                  string Modelpath = Path.GetDirectoryName(file);
- 
+                 Debug.Log($"[ImportModel(ref)] モデルパス: {Modelpath}");
                  var scen = Importer.ImportFile(file, Helper.PostProcessStepflags);
+                 Debug.Log($"[ImportModel(ref)] シーンのインポートに成功しました: {file}");
                  mesh.CombineMeshes(scen.Meshes.Select(x => new CombineInstance()
                  {
                      mesh = x.ToUnityMesh(),
                      transform = scen.RootNode.Transform.ToUnityMatrix()
                  }).ToArray(), false);
+                 Debug.Log($"[ImportModel(ref)] メッシュの結合に成功しました: {file}");
                  materials = new Material[scen.Meshes.Length];
- 				Debug.Log(materials.Length);
+                 Debug.Log($"[ImportModel(ref)] マテリアル数: {materials.Length}");
                  for (int index = 0; index < materials.Length; index++)
                  {
```

```diff
                          mat.name = scen.Materials[scen.Meshes[index].MaterialIndex].Name;
                          var textures = scen.Materials[scen.Meshes[index].MaterialIndex].GetAllTextures();
- 
- 
  
                          if (textures.Length > 0 && File.Exists(Path.Combine(Modelpath, textures[0].FilePath)))
```

```diff
                                      mat.mainTexture = DdsTextureLoader.LoadTexture(f.FullName);
                                      mat.SetTextureScale("_MainTex", new Vector2(1, -1));
+                                     Debug.Log($"[ImportModel(ref)] DDS/PNGテクスチャを読み込みました: {f.FullName}");
                                  }
                                  else
+                                 {
                                      mat.mainTexture = Helper.LoadTexture(f.FullName);
+                                     Debug.Log($"[ImportModel(ref)] テクスチャを読み込みました: {f.FullName}");
+                                 }
                              }
- 							catch
- 							{
+                             catch (Exception texEx)
+                             {
+                                 Debug.LogWarning($"[ImportModel(ref)] テクスチャの読み込みに失敗しました: {textures[0].FilePath} エラー: {texEx.Message}");
+                             }
+                         }
+                         else
+                         {
+                             Debug.Log($"[ImportModel(ref)] テクスチャが見つかりません: {textures.FirstOrDefault()?.FilePath}");
                          }
                      }
+                     else
+                     {
+                         Debug.Log($"[ImportModel(ref)] マテリアル情報が見つかりません: index={index}");
                      }
  
                      materials[index] = mat;
                  }
+                 Debug.Log($"[ImportModel(ref)] モデルのインポートが完了しました: {file}");
              }
- 			catch
+             catch (Exception ex)
              {
+                 Debug.LogError($"[ImportModel(ref)] モデルのインポート中にエラーが発生しました: {file} エラー: {ex.Message}");
              }
          }
          else
          {
- 			Debug.Log("File Doesn't Exist");
+             Debug.LogError($"[ImportModel(ref)] ファイルが存在しません: {file}");
          }
      }
  
      Mesh ImportModel(string file)
      {
+         Debug.Log($"[ImportModel(Mesh)] モデルのインポートを開始します: {file}");
          if (File.Exists(file))
          {
              try
              {
                  string Modelpath = Path.GetDirectoryName(file);
- 
+                 Debug.Log($"[ImportModel(Mesh)] モデルパス: {Modelpath}");
                  var scen = Importer.ImportFile(file, Helper.PostProcessStepflags);
+                 Debug.Log($"[ImportModel(Mesh)] シーンのインポートに成功しました: {file}");
                  Mesh mesh = new Mesh();
                  mesh.CombineMeshes(scen.Meshes.Select(x => new CombineInstance()
```

```diff
                      transform = scen.RootNode.Transform.ToUnityMatrix()
                  }).ToArray(), false);
- 
- 
+                 Debug.Log($"[ImportModel(Mesh)] メッシュの結合に成功しました: {file}");
+                 Debug.Log($"[ImportModel(Mesh)] モデルのインポートが完了しました: {file}");
                  return mesh;
              }
- 			catch
+             catch (Exception ex)
              {
+                 Debug.LogError($"[ImportModel(Mesh)] モデルのインポート中にエラーが発生しました: {file} エラー: {ex.Message}");
              }
          }
+         else
+         {
+             Debug.LogError($"[ImportModel(Mesh)] ファイルが存在しません: {file}");
+         }
          return null;
      }
```

---

各 `ImportModel` メソッドに日本語のデバッグログとエラーハンドリングを追加しました。

- 各処理の開始・成功・失敗・例外発生時に `Debug.Log` や `Debug.LogError` で日本語メッセージが出力されます。
- テクスチャやマテリアルの読み込み失敗時も警告ログが出ます。

これにより、Unityのコンソール上でどこで何が起きているかが日本語で詳細に把握できるようになります。  
他にも追加したい箇所や出力内容のご要望があればお知らせください。

---

